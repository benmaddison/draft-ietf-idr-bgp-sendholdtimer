<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<?rfc sortrefs="yes"?>
<?rfc subcompact="no"?>
<?rfc symrefs="yes"?>
<?rfc toc="yes"?>
<?rfc tocdepth="3"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>

<rfc
  category="std"
  docName="draft-spaghetti-idr-bgp-sendholdtimer-00"
  updates="4271"
  ipr="trust200902">
  
<front>
    
  <title abbrev="BGP SendHoldTimer">Border Gateway Protocol 4 (BGP-4) Send Hold Timer</title>

  <author fullname="Job Snijders" initials="J." surname="Snijders">
    <organization>Fastly</organization>
    <address>
      <postal>
        <street />
        <city>Amsterdam</city>
        <code />
        <country>Netherlands</country>
      </postal>
      <email>job@fastly.com</email>
    </address>
  </author>
  <author fullname="Ben Cartwright-Cox" initials="B." surname="Cartwright-Cox">
    <organization></organization>
    <address>
      <postal>
        <street />
        <city>London</city>
        <code />
        <country>United Kingdom</country>
      </postal>
      <email>ben@benjojo.co.uk</email>
    </address>
  </author>
  <date />

  <area>Routing</area>
  <workgroup>IDR</workgroup>
  <keyword>BGP</keyword>
  <keyword>session</keyword>
  <keyword>TCP</keyword>
  <keyword>EBGP</keyword>


  <abstract>

    <t>
      This document defines the SendHoldTimer session attribute for the Border Gateway Protocol (BGP) Finite State Machine (FSM).
      A session should be terminated if the TCP receive window is zero for the duration of the Hold Timer, in this situation the peer is expected to terminate the connection.
      For robustness, this document specifies that the local system should also close the connection.

      This document updates RFC4271.
    </t>

  </abstract>

  <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119">RFC 2119</xref>.
      </t>
  </note>

</front>

<middle>
  
  <section title="Introduction">

    <t>
      This document defines the SendHoldTimer session attribute for the Border Gateway Protocol (BGP) <xref target="RFC4271" /> Finite State Machine (FSM) defined in section 8.
      A session should be terminated if the TCP <xref target="RFC0793" /> receive window is zero for the duration of the Hold Timer, in this situation the peer is expected to terminate the connection.
      For robustness, this document specifies that the local system should also close the connection.
    </t>

    <t>
      As BGP runs over TCP it is possible for hosts in the ESTABLISHED state to encounter a BGP peer that is advertising a TCP zero windows size and thus preventing the local system from sending KEEPALIVE, CEASE, WITHDRAW, UPDATE, and other critical messages across the wire.
    </t>

    <t>
      At the moment of writing, most BGP implementations appear unable to handle this situation in a robust fashion.
      Not terminating a stuck BGP session can result in Denial Of Service, the subsequent failure to generate and deliver BGP WITHDRAW messages to other BGP peers of the local system is detrimental to all participants of the inter-domain routing system.
      This phenomena is theorised to have contributed to IP traffic backholing events in global Internet routing system <xref target="l3outage"/>
    </t>

  </section>

  <section title="Changes to RFC 4271">

    <t>
        In section 8 BGP Finite State Machine (FSM) <xref target="RFC4271"/>.
        The following mandatory session attributes are added:
    </t>

    <t>
      <list style="empty">
          <t> 
              9) SendHoldTimer
          </t>
          <t> 
              10) SendHoldTime
          </t>
      </list>
    </t>

    <t>
	OLD: 6.5.  Hold Timer Expired Error Handling
    </t>
    <t>
	If a system does not receive successive KEEPALIVE, UPDATE, and/or
	NOTIFICATION messages within the period specified in the Hold Time
	field of the OPEN message, then the NOTIFICATION message with the
	Hold Timer Expired Error Code is sent and the BGP connection is
	closed.
    </t>

    <t>
	NEW: 6.5.  Hold Timer Expired Error Handling
    </t>
    <t>
	If a system does not send and receive successive KEEPALIVE, UPDATE,
	and/or NOTIFICATION messages within the period specified in the Hold
	Time field of the open message, then the BGP connection is closed and
	a log message is emitted.
    </t>

  </section>

  <section title="Implementation status - RFC EDITOR: REMOVE BEFORE PUBLICATION">
    <t>
      This section records the status of known implementations of the protocol defined by this specification at the time of posting of this Internet-Draft, and is based on a proposal described in RFC 7942.
      The description of implementations in this section is intended to assist the IETF in its decision processes in progressing drafts to RFCs.
      Please note that the listing of any individual implementation here does not imply endorsement by the IETF.
      Furthermore, no effort has been spent to verify the information presented here that was supplied by IETF contributors.
      This is not intended as, and must not be construed to be, a catalog of available implementations or their features.
      Readers are advised to note that other implementations may exist.
    </t>
    <t>
      According to RFC 7942, "this will allow reviewers and working groups to assign due consideration to documents that have the benefit of running code, which may serve as evidence of valuable experimentation and feedback that have made the implemented protocols more mature.
      It is up to the individual working groups to use this information as they see fit".
    </t>
    <t>
      <list style="symbols">
        <t>
          OpenBGPD <xref target="openbgpd"/>
        </t>
       </list>
     </t>
     <t>
       While not a BGP implementation, as a result of investigation into this phenomena, the Linux TCP implementation TCP_USER_TIMEOUT option was improved, allowing easier termination of TCP sessions which are not progressing data <xref target="TCP_USER_TIMEOUT"/>.
     </t>
   </section>


  <section title="Acknowledgements">

    <t>
      The authors would like to thank William McCall for their helpful review of this document.
    </t>

  </section>

  <section title="Security Considerations">

    <t>
      This specification addresses the vulnerability of a BGP speaker to a potential attack whereby a BGP peer can pretend to be unable to process BGP messages and in doing so create a scenario in the local system is poisoned with stale routing information.
    </t>
    <t>
      There are three detrimental aspects to the problem this document describes:
      <list style="none">
        <t>
          Failure to send BGP messages to a peer is implies the peer is operating based on stale routing information.
        </t>
        <t>
          Failure to disconnect from a 'stuck' peer hinders the local system's ability to construct a non-stale local Routing Information Base (RIB).
        </t>
        <t>
          Failure to disconnect from a 'stuck' peer hinders the local system's ability to inform other BGP peers with current network reachability information.
        </t>
      </list>
    </t>
    <t>
      Absent this specification, the BGP session would not have been terminated; with this specification, an attacker is disconnected.
    </t>
    <t>
      In other respects, this specification does not change BGP's security characteristics.
    </t>
  </section>

  <section title="IANA Considerations">
    <!-- https://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#bgp-parameters-3 -->
    <t>
      This document requests IANA to assign a value named "Send Hold Timer Expired" in the "BGP Error (Notification) Codes" sub-registry under the "Border Gateway Protocol (BGP) Parameters" registry.
    </t>

  </section>

</middle>

<back>

  <references title="Normative References">
    <?rfc include="reference.RFC.2119.xml"?>
    <?rfc include="reference.RFC.4271.xml"?>
    <?rfc include="reference.RFC.0793.xml"?>
    <?rfc include="reference.RFC.8174.xml"?>
  </references>

  <references title="Informative References">

    <reference anchor="l3outage" target="https://www.reuters.com/article/level-3-communi-outages-idUSL2N1CB00C">
      <front>
        <title>Level 3 problem sparks temporary outage for some U.S. telecomms</title>
        <author><organization>Reuters</organization></author>
        <date month="August" year="2020"/>
      </front>
    </reference>

    <reference anchor="openbgpd" target="https://marc.info/?l=openbsd-tech&amp;m=160796802508185&amp;w=2">
      <front>
        <title>bgpd send side hold timer</title>
        <author fullname="Claudio Jeker"><organization>OpenBSD</organization></author>
        <date month="December" year="2020" />
      </front>
    </reference>

    <reference anchor="TCP_USER_TIMEOUT" target="https://mailarchive.ietf.org/arch/msg/idr/KOU59BTIvsqv8OHVBIvcVr97fD4/">
      <front>
        <title>[Idr] TCP &amp; BGP: Some don't send terminate BGP when holdtimer expired, because TCP recv window is 0</title>
        <author fullname="Enke Chen"><organization>Paolo Alto Networks</organization></author>
        <date month="January" year="2021" />
      </front>
    </reference>

  </references>

</back>

</rfc>
